<?xml version="1.0"?>
<launch>
    <arg name="plc_port" default="/dev/ttyUSB0"/>
    <node name="rosbridge_plc" pkg="rosbridge_driver" type="rosbridge_driver" output="screen">
        <param name="plc_port" value="$(arg plc_port)"/>
        <rosparam>
            port_chain:
              - name: plc_port
                type: serial
                serial_stop: 1
                timeout: 0.1
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x01, 0x02, 0xcf, 0xfd, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x01, crc16, little]
            topic_chain:
              - name: cmd_vel
                type: subscribe
                wheel_model: acke
                linear_ratio: 1.54 #1.0332 #2.87(v)/2.78(m/s) #3.5 #4.0 #2.296(v)/0.555(m/s)
                analog_min: 0.574 # 8.2*7%
                analog_max: 2.87 # 8.2*35%
                analog_mid: 4.06 #4.10 # 8.2*50%
                steer_ratio: 3.3 #3.3 #2.87
                steer_mid: 4.31
                plc_ratio: 3200.0 # 0~32000/0-10(v)
                wheel_base: 1.55
                vel_linear_max: 0.3
                Glight_forward: 68
                RBlight_back: 132
                stop_mode: pub_manual
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, 0x12, 0x00, 0x00, plc_io, big, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, speed_plc, big, angle_left, big, angle_right, big, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, crc16, little]
              - name: waypoint_user_pub
                type: subscribe
              - name: pub_manual
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x01, 0x02, 0xcf, 0xfd, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x01, crc16, little]
                    #time_out: 0.1
              - name: pub_auto
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, 0x12, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0xc9, 0x2d, 0xe6, 0x38, 0x66, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, crc16, little]
                    #time_out: 0.1
              - name: pub_warn_on
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, 0x12, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0xc9, 0x2d, 0xe6, 0x38, 0x66, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, crc16, little]
                    time_out: 5.0
              - name: pub_warn_off
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, 0x12, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0xc9, 0x2d, 0xe6, 0x38, 0x66, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, crc16, little]
                    #time_out: 5.0
              - name: pub_raise
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, 0x12, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0xc9, 0x2d, 0xe6, 0x38, 0x66, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, crc16, little]
                    #time_out: 5.0    
              - name: pub_down
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, 0x12, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0xc9, 0x2d, 0xe6, 0x38, 0x66, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, crc16, little]
                    #time_out: 5.0  
              - name: pub_forward
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, 0x12, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x15, 0x91, 0x2d, 0xe6, 0x38, 0x66, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, crc16, little]
                    #time_out: 5.0  
              - name: pub_back
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, 0x12, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x46, 0x50, 0x2d, 0xe6, 0x38, 0x66, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x10, 0x00, 0x64, 0x00, 0x09, crc16, little]
                    #time_out: 5.0  
              - name: pub_touch
                type: event
                action_chain:
                  - name: plc_port
                    type: write
                    byte: [0x06, 0x03, 0x00, 0x63, 0x00, 0x01, crc16, little]
                  - name: plc_port
                    type: read
                    byte: [0x06, 0x03, 0x02, touch, big, crc16, little]
                    time_out: 5.0
                echo: touch
              - name: diagnostics
                type: publish
        </rosparam>
    </node>
</launch>
