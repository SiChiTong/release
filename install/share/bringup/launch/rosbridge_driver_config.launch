<?xml version="1.0"?>
<launch>
    <arg name="driver_port" default="/dev/ttyUSB0"/>
    <node name="$(anon rosbridge_driver)" pkg="rosbridge_driver" type="rosbridge_driver" output="screen">
        <remap from="diagnostics" to="diagnostics2"/>
        <param name="drive_baud_port_left" value="$(arg driver_port)"/>
        <param name="drive_baud_port_right" value="$(arg driver_port)"/>
        <param name="drive_config_port_left" value="$(arg driver_port)"/>
        <param name="drive_config_port_right" value="$(arg driver_port)"/>
        <param name="imu_port" value="$(arg driver_port)"/>
        <param name="imu_config_port" value="$(arg driver_port)"/>
        <rosparam>
            port_chain:
              - name: drive_baud_port_left
                type: serial
                serial_baud: 9600
                serial_parity: 'E'
                serial_stop: 1
                timeout: 0.5
                respawn: false
                action_chain:
                  - name: drive_baud_port_left
                    type: write
                    byte: [0x02, 0x10, 0x00, 0x90, 0x00, 0x03, 0x06, 0x00, 0x01, 0xc2, 0x00, 0x00, 0x00, 0xe5, 0x46]
                  - name: drive_baud_port_left
                    type: read
                    byte: [0x02, 0x10, 0x00, 0x90, 0x00, 0x00, 0xc0, 0x17]
              - name: drive_baud_port_right
                type: serial
                serial_baud: 9600
                serial_parity: 'E'
                serial_stop: 1
                timeout: 0.5
                respawn: false
                action_chain:
                  - name: drive_baud_port_right
                    type: write
                    byte: [0x03, 0x10, 0x00, 0x90, 0x00, 0x03, 0x06, 0x00, 0x01, 0xc2, 0x00, 0x00, 0x00, 0xe7, 0xc7]
                  - name: drive_baud_port_right
                    type: read
                    byte: [0x03, 0x10, 0x00, 0x90, 0x00, 0x00, 0xc1, 0xc6]
              - name: drive_config_port_left
                type: serial
                timeout: 0.5
                respawn: false
                action_chain:
                  - name: drive_config_port_left
                    type: write
                    byte: [0x02, 0x10, 0x00, 0x60, 0x00, 0x17, 0x2E, 0x00, 0x00, 0x00, 0x00, 0xC3, 0x50, 0x1F, 0x40, 0xC3, 0x50, 0x1F, 0x40, 0x4E, 0x20, 0x1F, 0x40, 0x00, 0x00, 0x00, 0x00, 0x03, 0x48, 0x03, 0xE8, 0x02, 0x58, 0x02, 0x03, 0x01, 0x05, 0x04, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x2C, 0x00, 0x01, 0x00, 0x00, 0x9A, 0x44] #motor_param
                  - name: drive_config_port_left
                    type: read
                    byte: [0x02, 0x10, 0x00, 0x60, 0x00, 0x00, 0xC0, 0x24]
                  - name: drive_config_port_left
                    type: write
                    byte: [0x02, 0x10, 0x00, 0x80, 0x00, 0x1A, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0xDF, 0x00, 0x00, 0x27, 0x10, 0x07, 0xD0, 0x25, 0x80, 0x3F, 0x80, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x01, 0xC2, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x3F, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x95] #system_param
                  - name: drive_config_port_left
                    type: read
                    byte: [0x02, 0x10, 0x00, 0x80, 0x00, 0x00, 0xC1, 0xD2]
              - name: drive_config_port_right
                type: serial
                timeout: 0.5
                respawn: false
                action_chain:
                  - name: drive_config_port_right
                    type: write
                    byte: [0x03, 0x10, 0x00, 0x60, 0x00, 0x17, 0x2E, 0x00, 0x00, 0x00, 0x00, 0xC3, 0x50, 0x1F, 0x40, 0xC3, 0x50, 0x1F, 0x40, 0x4E, 0x20, 0x1F, 0x40, 0x00, 0x00, 0x00, 0x00, 0x03, 0x48, 0x03, 0xE8, 0x02, 0x58, 0x02, 0x03, 0x01, 0x05, 0x04, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x2C, 0x00, 0x01, 0x00, 0x00, 0x02, 0xE1] #motor_param
                  - name: drive_config_port_right
                    type: read
                    byte: [0x03, 0x10, 0x00, 0x60, 0x00, 0x00, 0xC1, 0xF5]
                  - name: drive_config_port_right
                    type: write
                    byte: [0x03, 0x10, 0x00, 0x80, 0x00, 0x1A, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0xDF, 0x00, 0x00, 0x27, 0x10, 0x07, 0xD0, 0x25, 0x80, 0x3F, 0x80, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x01, 0xC2, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x3F, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x94] #system_param
                  - name: drive_config_port_right
                    type: read
                    byte: [0x03, 0x10, 0x00, 0x80, 0x00, 0x00, 0xC0, 0x03]
              - name: imu_config_port
                type: serial
                serial_baud: 9600
                timeout: 0.5
                action_chain:
                  - name: imu_config_port
                    type: write
                    byte: [0xff, 0xaa, 0x04, 0x06, 0x00] #baud
                    lock: false
                  - name: imu_config_port
                    type: write
                    byte: [0xff, 0xaa, 0x00, 0x00, 0x00] #save
                    lock: false
                  - name: imu_config_port
                    type: read
                    byte: [0x55, 0x51, int_acc_x, little, int_acc_y, little, int_acc_z, little, int_temperature, little, sum81, 0x55, 0x52, int_gyr_x, little, int_gyr_y, little, int_gyr_z, little, int_temperature, little, sum82, 0x55, 0x53, int_roll, little, int_pitch, little, int_yaw, little, int_temperature, little, sum83, 0x55, 0x54, int_mag_x, little, int_mag_y, little, int_mag_z, little, int_temperature, little, sum84]
                    lock: true
              - name: imu_port
                type: serial
                timeout: 0.5
                action_chain:
                  - name: imu_port
                    type: write
                    byte: [0xff, 0xaa, 0x24, 0x01, 0x00] #axis
                    lock: false
                  - name: imu_port
                    type: write
                    byte: [0xff, 0xaa, 0x02, 0x1e, 0x00] #echo
                    lock: false
                  - name: imu_port
                    type: write
                    byte: [0xff, 0xaa, 0x03, 0x08, 0x00] #freq
                    lock: false
                  - name: imu_port
                    type: read
                    byte: [0x55, 0x51, int_acc_x, little, int_acc_y, little, int_acc_z, little, int_temperature, little, sum81, 0x55, 0x52, int_gyr_x, little, int_gyr_y, little, int_gyr_z, little, int_temperature, little, sum82, 0x55, 0x53, int_roll, little, int_pitch, little, int_yaw, little, int_temperature, little, sum83, 0x55, 0x54, int_mag_x, little, int_mag_y, little, int_mag_z, little, int_temperature, little, sum84]
                    lock: true
            topic_chain:
              - name: diagnostics
                type: publish
        </rosparam>
    </node>
</launch>
