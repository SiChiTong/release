<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>激光导航</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="jquery/jquery.mobile-1.3.2.min.css">
    <script src="jquery/jquery-1.8.3.min.js"></script>
    <script>
        $(document).bind('mobileinit', function () {
            $.mobile.changePage.defaults.changeHash = false;
            $.mobile.hashListeningEnabled = false;
            $.mobile.pushStateEnabled = false;
        });
    </script>
    <script src="jquery/jquery.mobile-1.3.2.min.js"></script>

    <script type="text/javascript" src="navigation/easeljs.min.js"></script>
    <script type="text/javascript" src="navigation/eventemitter2.min.js"></script>
    <script type="text/javascript" src="navigation/ros2d.js"></script>
    <script type="text/javascript" src="navigation/nav2d.js"></script>
    <script type="text/javascript" src="navigation/roslib.min.js"></script>
    <script type="text/javascript" src="navigation/three.min.js"></script>
       <script type="text/javascript" src="navigation/mjpegcanvas.min.js"></script>

    <script type="text/ecmascript" src="js/navigation.js"></script>

    <style>
        .ui-icon-voice {
            background-image: url(icons/icon1.png);
        }

        .ui-icon-net_success {
            background-image: url(icons/icon2.png);
        }

        .ui-icon-net_fail {
            background-image: url(icons/icon3.png);
        }

        label.ui-slider {
            font-size: 20px;
        }
    </style>
    <script>
        var Jobs;


        $(document).ready(function () {

            document.oncontextmenu = function (e) {
                e.preventDefault();
            }
            Jobs = new NavEvent.WorkPool();

            var H = $(document.body).height();
            var W = $(document.body).width();

            if (H >= 800) {
                H = 800;
            }
            if (W >= 800) {
                W = 800;
            }
            Jobs.MapInit(W * 0.8, H * 0.9);

            Jobs.MjpegInit(480, 320);

            Jobs.subscribeVel();

            $("#map").bind('swiperight', function () {
                // $.mobile.changePage("#page3", { transition: "slide", reverse: true }, false);
            }).bind('swipeleft', function () {
                //  $.mobile.changePage("#page1", { transition: "slide" }, true);
            }).bind('taphold', function (event) {
                event.preventDefault();
                $.mobile.changePage("#page4", { transition: "slide" });
            }).bind('tap', function () {

            });


            document.getElementById("touchBtn").addEventListener("touchstart", touchEvent, false);
            document.getElementById("touchBtn").addEventListener("touchend", touchEvent, false);
        });

        function touchEvent(event) {
            var event = event || window.event;
            switch (event.type) {
                case "touchstart":
                    if (event.target.id == "touchBtn") {
                        event.preventDefault = false;
                        NavEvent.imuLock = true;
                    }
              
                    break;
                case "touchend":
                    if (event.target.id == "touchBtn") {
                        NavEvent.imuLock = false;
                    }
                    break;
                case "touchmove":
                 
            
                    break;
            }
        }
        function ChangeSwitch(id) {
            console.log($("#" + id).val());
            if ($("#" + id).val() == "yes") {
                switch (id) {
                    case "switch1":
                        createjs.Touch.enable(myScene);
                        break;
                    case "switch2":
                        Jobs.Gmapping();
                        break;
                    case "switch3":
                        Jobs.OpenIMU();
                        break;
                    default:
                        break;

                }
            }
            else {
                switch (id) {
                    case "switch1":
                        createjs.Touch.disable(myScene);
                        break;
                    case "switch2":
                        Jobs.Navigation();
                        break;
                    case "switch3":
                        Jobs.CloseIMU();
                        break;
                    default:
                        break;

                }
            }

        }

    </script>
</head>
<body>
    <div data-role="page" id="page1" data-fullscreen="true">
        <div data-role="header" data-theme="b">
            <h1>激光导航小车控制系统</h1>
            <img id="netStaus" src="icons/icon4.png" style="position: absolute; right: 50px; top: 8px;" />
        </div>
        <div data-role="content">
            <div id="nav" style="margin: -15px">
            </div>
            <div style="position: fixed; top: 50px; right: 3%; text-align: center; border: solid 2px #000000; border-radius: 10px; box-shadow: 5px 5px 10px; background: #ffffff">
                <div style="margin-top: 20px">
                    <label for="switch1">触摸控制</label>
                    <select id="switch1" data-theme="e" name="switch1" data-role="slider" onchange="ChangeSwitch(this.id);">
                        <option value="no">关闭</option>
                        <option value="yes">开启</option>
                    </select>
                </div>

                <div style="margin-top: 20px">
                    <label for="switch2">建图模式</label>
                    <select id="switch2" name="switch2" data-theme="e" data-role="slider" onchange="ChangeSwitch(this.id);">
                        <option value="no">关闭</option>
                        <option value="yes">开启</option>
                    </select>
                </div>

                <div style="margin-top: 20px">
                    <label for="switch3">IMU监控</label>
                    <select id="switch3" name="switch3" data-theme="e" data-role="slider" onchange="ChangeSwitch(this.id);">
                        <option value="no">关闭</option>
                        <option value="yes">开启</option>
                    </select>
                </div>

            </div>


        </div>
        <div data-role="footer" data-id="menu">
            <div data-role="navbar">
                <ul>
                    <li><a data-icon="voice" class="ui-btn-active ui-state-persist">导航终端</a></li>
                    <li><a href="#page2" data-transition="flip" data-icon="voice">平面地图</a></li>
                    <li><a href="#page3" data-transition="flip" data-icon="voice">控制终端</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div data-role="page" id="page2" data-fullscreen="true">
        <div data-role="header">
            <h1>平面地图</h1>
        </div>
        <div data-role="content">
            <div data-role="controlgroup">
                <img id="map" src="image/map.png" style="width: 400px; height: auto" />
            </div>
        </div>
        <div data-role="footer" data-id="menu">
            <div data-role="navbar">
                <ul>
                    <li><a href="#page1" data-transition="flip" data-icon="voice">导航终端</a></li>
                    <li><a data-icon="voice" class="ui-btn-active ui-state-persist">平面地图</a></li>
                    <li><a href="#page3" data-transition="flip" data-icon="voice">控制终端</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div data-role="page" id="page3" data-fullscreen="true" style="z-index:100">
        <div data-role="header">
            <h1>控制终端</h1>
        </div>
        <div data-role="content">
            <p id="dataContainerOrientation" >No device orientation data</p>
            <p id="dataContainerMotion" >No device motion data</p>
            <p id="Linear">No linear data</p>
            <p id="Angular">No angular data</p>

            <div id="mjpeg" class="img" style="position:absolute;right:20%;top:10%;width:480px;height:320px;border:solid 0px #ff0000">
            </div>
            <div id="touchBtn"  style="position:absolute;right:0;top:15%;width:20%;height:70%;border:solid 0px #ff0000"></div>
        </div>
        <div data-role="footer" data-id="menu" data-position="fixed">
            <div data-role="navbar">
                <ul>
                    <li><a href="#page1" data-transition="flip" data-icon="voice">导航终端</a></li>
                    <li><a href="#page2" data-transition="flip" data-icon="voice">平面地图</a></li>
                    <li><a data-icon="voice" class="ui-btn-active ui-state-persist">控制终端</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div data-role="page" id="page4" data-add-back-btn="true">
        <div data-role="header">
            <h1>标记点设置</h1>
        </div>
        <div data-role="content">
            <div data-rel="fieldcontainer">
                <label for="name">Mark:</label>
                <input type="text" id="name" required placeholder="请输入标记名称">
                <label for="age">Text:</label>
                <input type="text" id="age" required placeholder="请输入语音介绍">

                <label for="pos_x">Postion.X:</label>
                <input type="text" id="pos_x" required placeholder="0.0000">
                <label for="pos_y">Postion.Y:</label>
                <input type="text" id="pos_y" required placeholder="0.0000">
                <label for="ori_z">Orientation.Z:</label>
                <input type="text" id="ori_z" required placeholder="0.00">
                <label for="ori_w">Orientation.W:</label>
                <input type="text" id="ori_w" required placeholder="0.00">

                <a data-role="button" data-theme="b">提 交</a>
            </div>
        </div>
        <div data-role="footer">
            <h1>噼里啪啦</h1>
        </div>
    </div>
</body>
</html>
