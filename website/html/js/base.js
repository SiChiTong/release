/*! tailinserver 2017-02-15 */
function MapEditDataConvert(a){for(var b=new Array,c=document.getElementById(a).getContext("2d"),d=document.getElementById(a),e=c.getImageData(0,0,d.width,d.height),f=0;f<d.height;f++)for(var g=0;g<d.width;g++){var h=g+(d.height-f-1)*d.width,i=4*(g+f*d.width);switch(e.data[i]){case 0:b[h]=100;break;case 255:b[h]=0;break;case 127:b[h]=-1;break;default:b[h]=100}}return b}function getWaypointIcon(a){var b="none";return"map"==NavEvent.WaypointList.waypoints[a].header.frame_id?b="location":"timer"==NavEvent.WaypointList.waypoints[a].header.frame_id?b="clock":"publisher"==NavEvent.WaypointList.waypoints[a].header.frame_id?b="navigation":"subscriber"==NavEvent.WaypointList.waypoints[a].header.frame_id?b="star":"looper"==NavEvent.WaypointList.waypoints[a].header.frame_id&&(b="recycle"),b}function DisableBrush(a){a.style.overflow="scroll",BrushEvent.disableCanvasEdit("map-edit-canvas"),$("#map-scorll").text("启用画笔"),$("#map-lines-add").prop("disabled",!0).addClass("ui-disabled"),$("#map-lines-delete").prop("disabled",!0).addClass("ui-disabled")}function EnableBrush(a){a.style.overflow="hidden",BrushEvent.enableCanvasEdit("map-edit-canvas"),$("#map-scorll").text("禁用画笔"),$("#map-lines-add").prop("disabled",!1).removeClass("ui-disabled"),$("#map-lines-delete").prop("disabled",!1).removeClass("ui-disabled")}function getIndexFromArray(a,b){try{for(var c=-1,d=0;d<b.length;d++)if(a==b[d].name)return c=d;return c}catch(e){return sweetAlert("获取站点信息失败","","error"),-1}}function DeleteSelectOption(a){-1==$(a).val()&&(deleteArray.push(parseInt(a.id.split("-")[2])),$(a).parent().parent().fadeOut(2e3,function(){$(a).remove()}))}function goPostion(a){var b=$(a).parent().parent().parent()[0].id,c=b.substring(3,b.length),d=c.split("-");"map"==d[0]?($(".btn1").prop("disabled",!0).addClass("ui-disabled"),NavEvent.CurrentPositionName=c):"pub"==d[0]||"sub"==d[0];var e=NavEvent.NavCtrlMessage(1,c),f=(getIndexFromArray(c,NavEvent.WaypointList.waypoints),NavEvent.Topic(NavEvent.TopicEnum.nav_ctrlTopic));NavEvent.TPublish(f,e)}function showTrajectoryMessage(a){$("#trajectory-info-list")[0].innerHTML="",$.mobile.changePage("#hrg-trajectory-info-page",{transition:"slide"});var b=$(a).parent().parent().parent()[0].id,c=b.substring(3,b.length);$("#trajectory-info-name").val(c);for(var d=getIndexFromArray(c,NavEvent.TrajectoryList.trajectories),e=0;e<NavEvent.TrajectoryList.trajectories[d].waypoints.length;e++){var f=NavEvent.TrajectoryList.trajectories[d].waypoints[e].name,g="location";"map"==NavEvent.TrajectoryList.trajectories[d].waypoints[e].header.frame_id?g="location":"timer"==NavEvent.TrajectoryList.trajectories[d].waypoints[e].header.frame_id?g="clock":"publisher"==NavEvent.TrajectoryList.trajectories[d].waypoints[e].header.frame_id?g="navigation":"subscriber"==NavEvent.TrajectoryList.trajectories[d].waypoints[e].header.frame_id?g="star":"looper"==NavEvent.TrajectoryList.trajectories[d].waypoints[e].header.frame_id&&(g="recycle");var h="<a style='padding:0.1em;margin-left:0;' data-icon='"+g+"' class='btn' onclick='showWaypointMessage(this)'>"+f+"</a></div>";$("#trajectory-info-list").append(h),$(".btn").button()}}function showWaypointMessage(a){$("#waypoint-info-list")[0].innerHTML="",$.mobile.changePage("#hrg-waypoints-info-page",{transition:"slide"});var b=$(a)[0].innerHTML;$("#hrg-waypoints-info-page h1")[0].innerHTML=b;var c=getIndexFromArray(b,NavEvent.WaypointList.waypoints),d=NavEvent.WaypointList.waypoints[c],e=" <div class='ui-grid-a' ><div class='ui-block-a'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-mark' class='btn '>Name</a></div><div class='ui-block-b'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-value' class='btn' >"+d.name+"</a></div></div>",f=" <div class='ui-grid-a' ><div class='ui-block-a'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-mark' class='btn'>Area</a></div><div class='ui-block-b'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-value' class='btn' >"+d.close_enough+"</a></div></div>",g=" <div class='ui-grid-a' ><div class='ui-block-a'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-mark' class='btn'>Timeout</a></div><div class='ui-block-b'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-value' class='btn' >"+d.goal_timeout+"</a></div></div>",h=" <div class='ui-grid-a' ><div class='ui-block-a'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-mark' class='btn'>Mode</a></div><div class='ui-block-b'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-value' class='btn' >"+d.failure_mode+"</a></div></div>",i=" <div class='ui-grid-a' ><div class='ui-block-a'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-mark' class='btn'>Action</a></div><div class='ui-block-b'><a style='padding:0.1em;margin-left:0;' data-icon='hrg-value' class='btn' >"+d.header.frame_id+"</a></div></div>";$("#waypoint-info-list").append(e),$("#waypoint-info-list").append(f),$("#waypoint-info-list").append(g),$("#waypoint-info-list").append(h),$("#waypoint-info-list").append(i),$(".btn").button()}function WaypointDelete(a){var b=$(a).parent().parent().parent()[0].id,c=b.substring(3,b.length);$($(a).parent().parent().parent()).fadeTo("slow",.01,function(){$(this).slideUp("slow",function(){var a=getIndexFromArray(c,NavEvent.WaypointList.waypoints),b=NavEvent.Topic(NavEvent.TopicEnum.waypoint_removeTopic);NavEvent.TPublish(b,NavEvent.WaypointList.waypoints[a]),$(this).remove()})})}function TrajectoryDelete(a){var b=$(a).parent().parent().parent()[0].id,c=b.substring(3,b.length);$($(a).parent().parent().parent()).fadeTo("slow",.01,function(){$(this).slideUp("slow",function(){var a=getIndexFromArray(c,NavEvent.TrajectoryList.trajectories),b=NavEvent.Topic(NavEvent.TopicEnum.trajectory_removeTopic);b.publish(NavEvent.TrajectoryList.trajectories[a]),$(this).remove()})})}function CheckStr(a){var b=/^[^@\/\'\\\"\‘\’#$%&\^\*]+$/;return b.test(a)}var BaseEvent=BaseEvent||{REVISION:"0.0.6.0-2016-12.22",FirstLoad:!0,StartWizard:!1,StartSaveMapEdit:!1,MapEditMessage:null,MachineModel:"",WaypointsHtml:"<option value='-1'>空</option>",selectid:0,UpdateSocket:null,Init:function(){document.oncontextmenu=function(a){a.preventDefault()},NavEvent.Subscribe(NavEvent.TopicEnum.shell_feedbackTopic,BaseEvent.feedbackCallback),NavEvent.Publish(NavEvent.TopicEnum.cmdTopic,NavEvent.CmdEnum.Userauth),BaseEvent.diagnosticsTopic=NavEvent.Topic(NavEvent.TopicEnum.diagnosticsTopic),BaseEvent.mapEditTopic=NavEvent.Topic(NavEvent.TopicEnum.map_editTopic)},feedbackCallback:function(a){switch(console.log(a),a.data){case"joy_on":$("#handle-switch").text("手柄关闭"),$("#handle-switch").buttonMarkup({icon:"hrg-start"});break;case"joy_off":$("#handle-switch").text("手柄开启"),$("#handle-switch").buttonMarkup({icon:"hrg-stop"});break;case"save_map":BaseEvent.StartWizard&&NavEvent.Publish(NavEvent.TopicEnum.cmdTopic,NavEvent.CmdEnum.LoadMap,NavEvent.CmdEnum.SaveMapEdit);break;case"save_map_edit":BaseEvent.StartWizard&&(NavEvent.Publish(NavEvent.TopicEnum.cmdTopic,NavEvent.CmdEnum.LoadMapEdit),$("#map-save").buttonMarkup({icon:"hrg-save"}),$.mobile.changePage("#hrg-map-wizard-third",{transition:"slide"}));break;case"save_as_map_edit":BaseEvent.StartWizard&&(BaseEvent.StartSaveMapEdit=!0,NavEvent.Navigation());break;default:var b=a.data.split(/[ :]/);switch(b[0]){case"version":$(".version").html(b[1]);break;case"user_status":TL.Plc_Current_State=b[1],256==b[1]?($("#btn-plc").buttonMarkup({icon:"hty-normal-run"}),$("#btn-plc").text("灭菌中")):257==b[1]?($("#btn-plc").buttonMarkup({icon:"hty-error-run"}),$("#btn-plc").text("PLC Running Exception")):0==b[1]&&""!=b[1]?($("#btn-plc").buttonMarkup({icon:"hty-stop"}),$("#btn-plc").text("启动灭菌")):1==b[1]?($("#btn-plc").buttonMarkup({icon:"hty-error-stop"}),$("#btn-plc").text("PLC Stop Exception")):console.log("temp[1]:%s",b[1]);break;case"user_auth":BaseEvent.MachineModel=b[1],NavEvent.Publish(NavEvent.TopicEnum.cmdTopic,NavEvent.CmdEnum.Version),"true"==b[1]?(NavEvent.Publish(NavEvent.TopicEnum.shellTopic,NavEvent.ShellEnum.PLCstatus),$.mobile.changePage("#hrg-login-page",{transition:"slide"})):$.mobile.changePage("#hrg-navigation-main-page",{transition:"slide"});break;case"software_update":document.getElementById("update-info").innerHTML+="<p>"+a.data.substring(b[0].length+1,a.data.length)+"</p>";break;case"error":"dbparam"==b[1]&&sweetAlert("正在切换中...","","warning");break;case"dbparam":Scene.MapList=b,Scene.CurrentMap=b[1],$(".current-map-name").text(b[1]),document.getElementById("map-select").innerHTML="";for(var c="",d=1;d<b.length;d++)c+="<option value='"+b[d]+"'>"+b[d]+"</option>";$("#map-select").append(c),$("#map-select").selectmenu(),$("#map-select").selectmenu("refresh"),Scene.CurrentMapCmd==Scene.MapCmdEnum.map_insert?Scene.CurrentMap==Scene.CreatMap&&($("#btn-map-insert").buttonMarkup({icon:"plus"}),sweetAlert("创建成功","","success")):Scene.CurrentMapCmd==Scene.MapCmdEnum.map_update?Scene.CurrentMap==Scene.SelectMap&&($(".current-map-name").text("加载中..."),$("#hrg-map-selected-popup").popup("close"),NavEvent.RemoveMap("nav"),NavEvent.ShowMap(800,800,"nav","/map_edit"),$("#nav canvas").on("taphold",function(){$("#hrg-manual-control-popup").popup(),$("#hrg-manual-control-popup").popup("open")})):Scene.CurrentMapCmd==Scene.MapCmdEnum.map_delete&&($("#btn-map-delete").buttonMarkup({icon:"minus"}),sweetAlert("删除成功","","success")),Scene.CurrentMapCmd=-1,Scene.CreatMap="",Scene.SelectMap="";break;case"roslog":$("#log").text(a.data.substring(b[0].length+1,a.data.length))}}},diagnosticsCallback:function(a){console.log(a);for(var b=0;b<a.status.length;b++)if("/Other/ros_mode"==a.status[b].name){switch(a.status[b].message){case NavEvent.NavigationModeEnum.Navigation:NavEvent.NavigationMode!=NavEvent.NavigationModeEnum.Navigation&&(console.log(a.status[b].message),NavEvent.NavigationMode=a.status[b].message,$(".btn-start-create-map").text("开启建图"),$(".btn-start-create-map").buttonMarkup({icon:"hrg-stop"}),BaseEvent.StartSaveMapEdit&&(BaseEvent.StartSaveMapEdit=!1,$("#map-edit-save").buttonMarkup({icon:"hrg-save"}),$.mobile.changePage("#hrg-menu-page",{transition:"slide"})));break;case NavEvent.NavigationModeEnum.Gmapping:NavEvent.NavigationMode!=NavEvent.CmdEnum.Gmapping&&(console.log(a.status[b].message),NavEvent.NavigationMode=a.status[b].message,$(".btn-start-create-map").text("关闭建图"),$(".btn-start-create-map").buttonMarkup({icon:"hrg-start"}),$.mobile.changePage("#hrg-map-wizard-second",{transition:"slide"}));break;case NavEvent.NavigationModeEnum.Coverting:NavEvent.NavigationMode!=NavEvent.CmdEnum.Coverting&&(console.log(a.status[b].message),NavEvent.NavigationMode=a.status[b].message,$(".btn-start-create-map").text("模式切换中..."),$(".btn-start-create-map").buttonMarkup({icon:"hrg-load"}))}return}},mapEditCallback:function(a){$("#map-edit-canvas-father img").hide(),BaseEvent.mapEditTopic.unsubscribe(BaseEvent.mapEditCallback),BaseEvent.MapEditMessage=a;var b=document.getElementById("map-edit-canvas"),c=b.getContext("2d");b.width=a.info.width,b.height=a.info.height;for(var d=c.createImageData(b.width,b.height),e=0;e<b.height;e++)for(var f=0;f<b.width;f++){var g,h=f+(b.height-e-1)*b.width,i=a.data[h];g=100===i?0:0===i?255:127;var j=4*(f+e*b.width);d.data[j]=g,d.data[++j]=g,d.data[++j]=g,d.data[++j]=255}c.putImageData(d,0,0),$("#hrg-map-wizard-third").css("background","grey"),$("#map-edit-canvas").show();var k=document.getElementById("map-edit-canvas-father");k.scrollLeft=k.scrollWidth/2-100,k.scrollTop=k.scrollHeight/2-100},systemDiagnosticsCallback:function(a){BaseEvent.diagnosticsTopic.unsubscribe(BaseEvent.systemDiagnosticsCallback);for(var b=0;b<a.status.length;b++){var c="<div data-role='collapsible'><h3>"+a.status[b].name+"</h3><p>"+a.status[b].message+"</p></div>";$("#diagnostics-list").append(c)}$("#diagnostics-list").trigger("create"),$("#diagnostics-list").collapsibleset("refresh"),$("#hrg-diagnosis-content img").hide()},globalPlannerCallback:function(a){console.log(a)},diagnosticsTopic:null,mapEditTopic:null};$(function(){NavEvent.Init({onopen:function(){BaseEvent.Init(),$(".networkstatus").buttonMarkup({icon:"hrg-networksuccess"})},onclose:function(){$(".networkstatus").buttonMarkup({icon:"hrg-networkerror"}),sweetAlert("网络连接失败","","error")}}),$("#hrg-navigation-main-page").live("pageshow",function(a,b){if("hrg-login-page"==b.prevPage[0].id){if(BaseEvent.FirstLoad){BaseEvent.FirstLoad=!1;var c="<a href='#hty-user-manger-page' data-transition='slide' class='btn-hty ui-btn ui-icon-hrg-user ui-btn-icon-notext ui-corner-all ui-btn-left'></a>";$("#hrg-menu-page-header").append(c);var d="<a href='#hty-super-page' class='btn-hty' data-transition='slide' data-role='button' data-icon='carat-r' data-iconpos='right' style='background: #0ff;'>HTY-SUPER SD6</a>";$("#hrg-menu-page-content").append(d),NavEvent.Publish(NavEvent.TopicEnum.cmdTopic,NavEvent.CmdEnum.Map_Select),NavEvent.ShowMap(800,800,"nav","/map_edit"),$("#nav canvas").on("taphold",function(){$("#hrg-manual-control-popup").popup(),$("#hrg-manual-control-popup").popup("open")})}}else if("hrg-main-page"==b.prevPage[0].id&&BaseEvent.FirstLoad){BaseEvent.FirstLoad=!1;var c="<a href='#hrg-super-page' data-transition='slide' class='ui-btn ui-icon-hrg-user ui-btn-icon-notext ui-corner-all ui-btn-left'></a>";$("#hrg-menu-page-header").append(c),NavEvent.Publish(NavEvent.TopicEnum.cmdTopic,NavEvent.CmdEnum.Map_Select),NavEvent.ShowMap(800,800,"nav","/map_edit"),$("#nav canvas").on("taphold",function(){$("#hrg-manual-control-popup").popup(),$("#hrg-manual-control-popup").popup("open")})}}),$(".btn-start-create-map").click(function(){"模式切换中..."!=$(this).text()&&($(this).text("模式切换中..."),$(this).buttonMarkup({icon:"hrg-load"}),NavEvent.NavigationMode==NavEvent.NavigationModeEnum.Navigation?NavEvent.Gmapping():NavEvent.NavigationMode==NavEvent.NavigationModeEnum.Gmapping?NavEvent.Navigation():NavEvent.NavigationMode==NavEvent.NavigationModeEnum.Coverting||($(this).text("开启建图"),$(this).buttonMarkup({icon:"hrg-stop"}),sweetAlert("获取导航状态失败","","error")))}),$("#hrg-map-wizard-frist").live("pageshow",function(a,b){null!=BaseEvent.diagnosticsTopic&&(BaseEvent.StartWizard=!0,BaseEvent.diagnosticsTopic.subscribe(BaseEvent.diagnosticsCallback))}),$("#hrg-map-wizard-frist").live("pagehide",function(a,b){"hrg-map-wizard-second"!=b.nextPage[0].id&&null!=BaseEvent.diagnosticsTopic&&(BaseEvent.diagnosticsTopic.unsubscribe(BaseEvent.diagnosticsCallback),BaseEvent.StartWizard=!1)}),$("#hrg-map-wizard-second").live("pageshow",function(a,b){NavEvent.ShowMap(800,800,"nav1","/map"),$("#nav1 canvas").on("taphold",function(){$("#hrg-manual-control-popup").popup(),$("#hrg-manual-control-popup").popup("open")})}),$("#map-save").click(function(){NavEvent.SaveMap(),$(this).buttonMarkup({icon:"hrg-load"})}),$("#hrg-map-wizard-second").live("pagehide",function(a,b){NavEvent.RemoveMap("nav1"),$("#nav1 canvas").off("taphold")}),$("#hrg-map-wizard-third").live("pageshow",function(a,b){$("#map-edit-canvas").on("taphold",function(){$("#hrg-brush-set-popup").popup(),$("#hrg-brush-set-popup").popup("open")}),BrushEvent.disableCanvasEdit("map-edit-canvas-father"),$("#map-edit-canvas").hide(),$("#map-edit-canvas-father img").show(),BaseEvent.mapEditTopic.subscribe(BaseEvent.mapEditCallback),$(this).css("background","white")}),$("#map-edit-save").click(function(){console.log("map-edit-save"),$(this).buttonMarkup({icon:"hrg-load"});var a=BaseEvent.MapEditMessage.info,b=MapEditDataConvert("map-edit-canvas");NavEvent.SaveAsMapEdit(a,b);var c=document.getElementById("map-edit-canvas-father");"hidden"==c.style.overflow&&DisableBrush(c)}),$("#map-scorll").click(function(){var a=document.getElementById("map-edit-canvas-father");$("#hrg-brush-set-popup").popup("close"),"hidden"==a.style.overflow?DisableBrush(a):EnableBrush(a)}),$("#map-lines-delete").click(function(){BrushEvent.mapEditcolor="white",BrushEvent.mapEditlineWidth=5,$(this).buttonMarkup({icon:"hrg-edit-red"}),$("#map-lines-add").buttonMarkup({icon:"hrg-edit-white"})}),$("#map-lines-add").click(function(){BrushEvent.mapEditcolor="black",BrushEvent.mapEditlineWidth=3,$(this).buttonMarkup({icon:"hrg-edit-red"}),$("#map-lines-delete").buttonMarkup({icon:"hrg-edit-white"})}),$("#hrg-map-wizard-third").live("pagehide",function(a,b){BaseEvent.diagnosticsTopic.unsubscribe(BaseEvent.diagnosticsCallback),BaseEvent.StartWizard=!1}),$("#hrg-system-diagnosis-page").live("pageshow",function(a,b){BaseEvent.diagnosticsTopic.unsubscribe(BaseEvent.systemDiagnosticsCallback)}),$("#hrg-system-diagnosis-page").live("pagehide",function(a,b){$("#diagnostics-list div").remove(),$("#hrg-diagnosis-content img").show()}),NavEvent.Subscribe(NavEvent.TopicEnum.poseTopic,function(a){$("#pos_x").val(a.position.x),$("#pos_y").val(a.position.y),$("#ori_z").val(a.orientation.z),$("#ori_w").val(a.orientation.w)}),NavEvent.Subscribe(NavEvent.TopicEnum.waypointTopic,function(a){console.log(a),NavEvent.WaypointList=a,$("#waypoint-list")[0].innerHTML="",BaseEvent.WaypointsHtml="<option value='-1'>空</option>";for(var b=0;b<a.waypoints.length;b++){var c=a.waypoints[b].name,d="location";d=getWaypointIcon(b);var e=" <div class='ui-grid-a' id='way"+c+"'><div class='ui-block-a'><a style='padding:0.1em;margin-left:0;' data-icon='"+d+"' class='btn btn1' id='btn-waypoint-"+c+"' onclick='goPostion(this)'>"+c+"</a></div><div class='ui-block-b'><a style='padding:0.1em;margin-left:0;' data-icon='delete' class='btn btn1' onclick='WaypointDelete(this)'>删除</a></div></div>";BaseEvent.WaypointsHtml+="<option value='"+b+"'>"+c+"</option>",$("#waypoint-list").append(e)}$(".btn").button()}),NavEvent.Subscribe(NavEvent.TopicEnum.trajectoryTopic,function(a){console.log(a),NavEvent.TrajectoryList=a,$("#trajectory-list")[0].innerHTML="";for(var b=0;b<a.trajectories.length;b++){var c=a.trajectories[b].name,d="<div data-role='collapsible' class='coll'><h3>"+c+"</h3> <div class='ui-grid-b' id='tra"+c+"'><div class='ui-block-a'><a style='padding:0.1em;margin-left:0;' data-icon='location' class='btn btn1'id='btn-trajectorie-"+c+"' onclick='goPostion(this)'>"+c+"</a></div><div class='ui-block-b'><a style='padding:0.1em;margin-left:0;' data-icon='info' class='btn btn1' onclick='showTrajectoryMessage(this)'>详情</a></div><div class='ui-block-c'><a style='padding:0.1em;margin-left:0;' data-icon='delete' class='btn btn1' onclick='TrajectoryDelete(this)'>删除</a></div></div></div>";$("#trajectory-list").append(d)}$(".btn").button(),$("#trajectory-list").collapsibleset().trigger("create"),$("#trajectory-list").collapsibleset("refresh")}),NavEvent.Subscribe(NavEvent.TopicEnum.nav_ctrl_statusTopic,function(a){if(console.log(a),""==a.waypoint_name&&0==a.status)return $(".btn1").prop("disabled",!1).removeClass("ui-disabled"),void(Scene.StartSelectMap&&($(".current-map-name").text(Scene.CurrentMap),Scene.StartSelectMap=!1));var b=getIndexFromArray(a.waypoint_name,NavEvent.WaypointList.waypoints),c="none";-1!=b&&(c=getWaypointIcon(b));var d=getIndexFromArray(NavEvent.CurrentPositionName,NavEvent.WaypointList.waypoints),e="none";switch(-1!=d&&(e=getWaypointIcon(d)),a.status){case 1:"map"==a.waypoint_name.split("-")[0]&&($("#btn-waypoint-"+NavEvent.CurrentPositionName).parent().buttonMarkup({icon:e}),$("#btn-waypoint-"+a.waypoint_name).parent().buttonMarkup({icon:"hrg-load"}));break;case 3:$("#btn-waypoint-"+a.waypoint_name).parent().buttonMarkup({icon:c});break;case 0:$(".btn1").prop("disabled",!1).removeClass("ui-disabled");break;case 4:$("#btn-waypoint-"+a.waypoint_name).parent().buttonMarkup({icon:c}),$(".btn1").prop("disabled",!1).removeClass("ui-disabled")}"all waypoints"!=a.waypoint_name&&(NavEvent.CurrentPositionName=a.waypoint_name)}),$("#btn-add-waypoint").click(function(){if(!CheckStr($("#name")[0].value))return void sweetAlert("字符不合法","","warning");var a=NavEvent.Pose(parseFloat($("#pos_x")[0].value),parseFloat($("#pos_y")[0].value),parseFloat($("#ori_z")[0].value),parseFloat($("#ori_w")[0].value)),b=$("#waypoints-action").val(),c=$("#timeout")[0].value,d=$("#area")[0].value,e=$("#waypoints-mode").val(),f="map";"map"==b?f="map":"timer"==b?f="timer":"publisher"==b?f="pub":"subscriber"==b?f="sub":"looper"==b&&(f="loop");var g=f+"-"+$("#name")[0].value,h=getIndexFromArray(g,NavEvent.TrajectoryList.trajectories);if(-1!==h)return void sweetAlert("Waypoint:"+g+" 在Trajectory列表中已占用 位于Trajectory["+h+"]","","error");""==c&&(c=0),""==d&&(d=0);var i=NavEvent.WaypointMessage(g,a,parseFloat(d),parseFloat(c),e,b);NavEvent.WayPointAdd(i),$.mobile.changePage("#hrg-navigation-setting-page",{transition:"slide"})}),$("#btn-add-trajectory").click(function(){var a=!1,b=$("#trajectory-name")[0].value;if(""==b)return void sweetAlert("轨迹名称不能为空","","warning");var c=getIndexFromArray(b,NavEvent.WaypointList.waypoints);if(-1!==c)return void sweetAlert("Waypoint:"+b+" 在Trajectory列表中已占用 位于Trajectory["+c+"]","","error");for(var d=new Array,e=1;e<=BaseEvent.selectid;e++){var f=deleteArray.indexOf(e);if(-1==f){a=!0;var c=getIndexFromArray($("#select-native-"+e).find("option:selected").text(),NavEvent.WaypointList.waypoints);if(-1==c)return void sweetAlert("添加的站点无效","","warning");d.push(NavEvent.WaypointList.waypoints[c])}}if(a){var g=NavEvent.TrajectoryMessage(b,d);NavEvent.TrajectoryAdd(g),$.mobile.changePage("#hrg-navigation-setting-page",{transition:"slide"})}else sweetAlert("未设定路点","","warning")}),$("#hrg-add-trajectory-page").live("pagehide",function(a,b){BaseEvent.selectid=0,deleteArray=[],$("#waypoint-item select").remove()}),$("#btn-add-waypoint-item").click(function(){BaseEvent.selectid++;var a="<select name='select-native-"+BaseEvent.selectid+"'id='select-native-"+BaseEvent.selectid+"' data-iconpos='right' onchange='DeleteSelectOption(this)'>"+BaseEvent.WaypointsHtml+"</select>";$("#waypoint-item").append(a),$("#select-native-"+BaseEvent.selectid).selectmenu(),$("#select-native-"+BaseEvent.selectid).selectmenu("refresh"),$("#select-native-"+BaseEvent.selectid).parent().parent().hide(),$("#select-native-"+BaseEvent.selectid).parent().parent().fadeIn(2e3)}),$("#cancel").click(function(){var a=NavEvent.NavCtrlMessage(0,NavEvent.CurrentPositionName),b=NavEvent.Topic(NavEvent.TopicEnum.nav_ctrlTopic);NavEvent.TPublish(b,a)}),$(".up").on("touchstart touchend",function(a){"touchstart"==a.type?(a.preventDefault(),$(this).attr("src","images/up1.png"),NavEvent.goFront()):"touchend"==a.type&&($(this).attr("src","images/up.png"),NavEvent.goStop())}),$(".down").on("touchstart touchend",function(a){"touchstart"==a.type?(a.preventDefault(),$(this).attr("src","images/down1.png"),NavEvent.goBack()):"touchend"==a.type&&($(this).attr("src","images/down.png"),NavEvent.goStop())}),$(".left").on("touchstart touchend",function(a){"touchstart"==a.type?(a.preventDefault(),$(this).attr("src","images/left1.png"),NavEvent.goLeft()):"touchend"==a.type&&($(this).attr("src","images/left.png"),NavEvent.goStop())}),$(".right").on("touchstart touchend",function(a){"touchstart"==a.type?(a.preventDefault(),$(this).attr("src","images/right1.png"),NavEvent.goRight()):"touchend"==a.type&&($(this).attr("src","images/right.png"),NavEvent.goStop())}),$(".stop").on("touchstart touchend",function(a){"touchstart"==a.type?(a.preventDefault(),$(this).attr("src","images/stopmove1.png"),NavEvent.goStop()):"touchend"==a.type&&($(this).attr("src","images/stopmove.png"),NavEvent.goStop())}),$("#hrg-system-log-page").live("pageshow",function(a,b){NavEvent.Publish(NavEvent.TopicEnum.cmdTopic,NavEvent.CmdEnum.Roslog_select)}),$("#hrg-software-update-page").live("pageshow",function(a,b){var c="<iframe src='update.html' style='width:100%;height:100%;' frameborder='0'></iframe>";$("#update-content").append(c)}),$("#hrg-software-update-page").live("pagehide",function(a,b){$("#update-content iframe").remove()}),$("#hrg-add-waypoints-page").live("pageshow",function(a,b){$("#hrg-add-waypoints-page-content").on("taphold",function(){$("#hrg-manual-control-popup").popup(),$("#hrg-manual-control-popup").popup("open")})}),$("#hrg-add-waypoints-page").live("pagehide",function(a,b){$("#hrg-add-waypoints-page-content").off("taphold",function(){$("#hrg-manual-control-popup").popup(),$("#hrg-manual-control-popup").popup("open")})})});var deleteArray=new Array;